<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<!--//네임스페이스에는 mapper 가 있는 풀 패키지명과 매퍼명을 등록 한다. -->
<mapper namespace="com.utime.memoBom.board.mapper.TopicMapper">

	<!--토픽 테이블 생성-->
	<insert id="createTopic">
		CREATE TABLE MB_TOPIC (
			TOPIC_NO     BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
			, REG_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL <!-- 생성일 -->
			, UPDATE_DATE TIMESTAMP NOT NULL <!-- 수정일 -->
			, ENABLED BOOLEAN DEFAULT FALSE NOT NULL <!-- 사용 여부. T:사용, F:미사용 -->
			, EXTERNAL BOOLEAN DEFAULT TRUE NOT NULL <!-- 공개 여부. T:공개, F:미공개 -->
			, UID UUID DEFAULT RANDOM_UUID() NOT NULL <!-- 고유 ID -->
			, NAME VARCHAR(36) NOT NULL
			, HASH_KEYWORD VARCHAR(256)
			, DESCRIPTION VARCHAR(256)
			, ICON VARCHAR(16) <!--선택: 이모지/짧은 문자열-->
			, COLOR VARCHAR(16)  <!--선택: '#RRGGBB' 또는 'indigo' 등-->
		)
	</insert>
	
	<insert id="createTopicFlow">
		CREATE TABLE MB_TOPIC_FOLLOW (
			USER_ID BIGINT NOT NULL,
			TOPIC_NO BIGINT NOT NULL,
			CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	
			PRIMARY KEY (USER_NO, TOPIC_NO),
			CONSTRAINT FK_TOPIC_FOLLOW_USER FOREIGN KEY (USER_NO) REFERENCES MB_USER(USER_NO),
			CONSTRAINT FK_TOPIC_FOLLOW_TOPIC FOREIGN KEY (TOPIC_NO) REFERENCES MB_TOPIC(TOPIC_NO)
		)
	</insert>
	
	<select id="hasTopic" parameterType="com.utime.memoBom.user.vo.UserVo" resultType="boolean">
		SELECT 
			CASE COUNT(1) 
	   			WHEN 0 THEN 0
				ELSE 1
	   		END AS RES
	   	FROM MB_TOPIC_FOLLOW FL
	   		INNER JOIN MB_TOPIC TP ON FL.TOPIC_NO = TP.TOPIC_NO
	   	WHERE TP.ENABLED = TRUE AND FL.USER_NO = #{userNo}
	</select>
	
</mapper>