<th:block xmlns:th="http://www.thymeleaf.org" th:fragment="Header_Error">
	<div class="grid grid-cols-3 items-center h-full px-2">
		<button type="button" aria-label="back" onclick="history.back()"
			class="justify-self-start text-2xl leading-none">
			ğŸ”™
		</button>
		<h1 class="justify-self-center text-base font-semibold leading-none">
			Error
		</h1>
		<div class="justify-self-end w-8 h-6"></div>
	</div>
</th:block>
<th:block xmlns:th="http://www.thymeleaf.org" th:fragment="Header_Back(title)">
	<div class="grid grid-cols-3 items-center h-full px-2">
		<button type="button" aria-label="back" onclick="history.back()"
			class="justify-self-start text-2xl leading-none">
			ğŸ”™
		</button>
		<h1 class="justify-self-center text-base font-semibold leading-none">
			[[${title}]]  
		</h1>
		<div class="justify-self-end w-8 h-6"></div>
	</div>
</th:block>
<th:block xmlns:th="http://www.thymeleaf.org" th:fragment="Header_TopicMain">
	<div class="grid grid-cols-3 items-center h-full px-2">
		<button type="button" aria-label="back" onclick="history.back()"
			class="justify-self-start text-2xl leading-none">
			ğŸ”™
		</button>
		<h1 class="justify-self-center text-base font-semibold leading-none">
			Topic
		</h1>
		<div class="justify-self-end w-8 h-6"></div>
	</div>
</th:block>
<th:block xmlns:th="http://www.thymeleaf.org" th:fragment="Header_Search(leftTitle, title, rightTitle)">
	<div id="headerSearchRoot" class="h-full px-2 flex items-center">


		<div class="shrink-0 flex items-center">
			<!-- Left button -->
			<button type="button" aria-label="left" onclick="functionLeft()"
				class="shrink-0 w-10 h-10 flex items-center justify-center text-2xl leading-none">
				[[${leftTitle}]]
			</button>

			<!-- âœ… spacer: ì˜¤ë¥¸ìª½(ğŸ”+ìš°ì¸¡ë²„íŠ¼) 1ì¹¸ = w-10 -->
			<div data-role="left-spacer" class="w-10"></div>
		</div>
		<!-- Center area (Title / Search input) -->
		<div class="flex-1 min-w-0">
			<!-- Title -->
			<h1 data-role="title" class="text-center text-base font-semibold leading-none truncate">
				[[${title}]]
			</h1>

			<!-- Search overlay (shown when searching) -->
			<div data-role="search" class="hidden">
				<div class="flex items-center w-full border border-gray-300 rounded-md bg-white px-2 py-1">
					<input data-role="input" type="search" inputmode="search" autocomplete="off" placeholder="ê²€ìƒ‰"
						class="flex-1 min-w-0 bg-transparent outline-none text-sm" />
					<button type="button" aria-label="search" data-action="do-search"
						class="shrink-0 px-2 text-xl leading-none">
						ğŸ”
					</button>
				</div>
			</div>
		</div>

		<!-- Right area: (Search button ë¶™ì–´ì„œ) + Right button -->
		<div class="shrink-0 flex items-center gap-0">
			<button type="button" aria-label="open-search" data-action="open-search"
				class="w-10 h-10 flex items-center justify-center text-xl leading-none">
				ğŸ”
			</button>
			<button type="button" aria-label="right" data-role="right-btn" onclick="functionRight()"
				class="w-10 h-10 flex items-center justify-center text-2xl leading-none">
				[[${rightTitle}]]
			</button>
		</div>
	</div>

	<script>
		(function () {
			const root = document.getElementById('headerSearchRoot');
			if (!root) return;

			const titleEl = root.querySelector('[data-role="title"]');
			const searchWrap = root.querySelector('[data-role="search"]');
			const inputEl = root.querySelector('[data-role="input"]');
			const btnOpen = root.querySelector('[data-action="open-search"]');
			const btnDo = root.querySelector('[data-action="do-search"]');
			const rightBtn = root.querySelector('[data-role="right-btn"]');

			let isOpen = false;

			function setOpen(next) {
				isOpen = !!next;
				titleEl.classList.toggle('hidden', isOpen);
				searchWrap.classList.toggle('hidden', !isOpen);
				btnOpen.classList.toggle('hidden', isOpen);
				rightBtn.classList.toggle('hidden', isOpen);

				if (isOpen) {
					setTimeout(() => inputEl && inputEl.focus(), 0);
					document.addEventListener('mousedown', onOutside, true);
					document.addEventListener('touchstart', onOutside, true);
				} else {
					document.removeEventListener('mousedown', onOutside, true);
					document.removeEventListener('touchstart', onOutside, true);
				}
			}

			// ê²€ìƒ‰ ì˜ì—­ ë°– í´ë¦­/í„°ì¹˜ ì‹œ ë‹«í˜
			function onOutside(e) {
				if (!isOpen) return;
				if (!searchWrap.contains(e.target)) setOpen(false);
			}

			function doSearch() {
				const keyword = (inputEl?.value || '').trim();
				if (typeof window.headerSearch === 'function') {
					window.headerSearch(keyword);
				} else {
					console.warn('headerSearch(keyword) í•¨ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.');
				}
				setOpen(false);
			}

			btnOpen?.addEventListener('click', () => setOpen(true));
			btnDo?.addEventListener('click', doSearch);

			inputEl?.addEventListener('keydown', (e) => {
				if (e.key === 'Enter') doSearch();
				if (e.key === 'Escape') setOpen(false);
			});
		})();
	</script>
</th:block>